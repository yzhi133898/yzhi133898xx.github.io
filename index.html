<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生就业信息管理系统</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { padding: 20px; font-family: "Microsoft YaHei", sans-serif; }
        h1 { text-align: center; margin-bottom: 20px; }
        /* 登录注册窗口样式 */
        .auth-modal { display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 100; }
        .auth-content { background: #fff; padding: 30px; border-radius: 8px; width: 400px; }
        .auth-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #ddd; }
        .auth-tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; font-weight: bold; }
        .auth-tab.active { color: #4CAF50; border-bottom: 2px solid #4CAF50; }
        .auth-form { display: none; }
        .auth-form.active { display: block; }
        .auth-form div { margin-bottom: 15px; }
        .auth-form label { display: block; margin-bottom: 5px; }
        .auth-form input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .auth-btn { width: 100%; padding: 10px; border: none; border-radius: 4px; background: #4CAF50; color: #fff; cursor: pointer; font-size: 16px; }
        .auth-btn:hover { background: #45a049; }
        .tip { color: red; font-size: 14px; margin-top: 5px; }

        /* 原有样式保留 */
        .btn-group { margin: 10px 0; display: flex; gap: 10px; align-items: center; }
        .add, .export, .search-btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; color: #fff; }
        .add { background: #4CAF50; }
        .export { background: #2196F3; }
        .search-btn { background: #ff9800; }
        .search-input, .sort-select { padding: 6px; border: 1px solid #ccc; border-radius: 4px; }
        .search-input { width: 200px; }
        .info { background: cadetblue; padding: 15px; margin: 10px 0; display: flex; flex-wrap: wrap; gap: 15px; border-radius: 4px; }
        .title { height: 50px; background: antiquewhite; display: flex; align-items: center; justify-content: center; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
        th { background: #f0e6d6; cursor: pointer; }
        .operation a { margin: 0 5px; text-decoration: none; color: #d9534f; }
        .operation a.edit { color: #28a745; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background: #fff; padding: 20px; border-radius: 6px; width: 500px; }
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .close-btn { background: none; border: none; font-size: 20px; cursor: pointer; }
        .modal-footer { margin-top: 15px; text-align: right; }
        .submit-btn, .cancel-btn { padding: 5px 10px; margin-left: 10px; border: none; border-radius: 4px; cursor: pointer; }
        .submit-btn { background: burlywood; }
        .cancel-btn { background: #ccc; }
        /* 未登录时隐藏操作区 */
        .operation-area { display: none; }
    </style>
</head>
<body>
    <h1>学生就业信息管理系统</h1>

    <!-- 登录/注册窗口（默认显示） -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">登录</div>
                <div class="auth-tab" data-tab="register">注册</div>
            </div>
            <!-- 登录表单 -->
            <form class="auth-form active" id="loginForm">
                <div>
                    <label>用户名</label>
                    <input type="text" id="loginUsername" required placeholder="请输入用户名">
                </div>
                <div>
                    <label>密码</label>
                    <input type="password" id="loginPassword" required placeholder="请输入密码">
                    <div class="tip" id="loginTip"></div>
                </div>
                <button type="submit" class="auth-btn">登录</button>
            </form>
            <!-- 注册表单 -->
            <form class="auth-form" id="registerForm">
                <div>
                    <label>用户名</label>
                    <input type="text" id="regUsername" required placeholder="请设置用户名">
                </div>
                <div>
                    <label>密码</label>
                    <input type="password" id="regPassword" required placeholder="请设置密码（≥6位）">
                </div>
                <div>
                    <label>确认密码</label>
                    <input type="password" id="regConfirmPwd" required placeholder="请再次输入密码">
                    <div class="tip" id="regTip"></div>
                </div>
                <button type="submit" class="auth-btn">注册</button>
            </form>
        </div>
    </div>

    <!-- 操作区（未登录时隐藏） -->
    <div class="operation-area" id="operationArea">
        <!-- 功能区 -->
        <div class="btn-group">
            <button class="add">增加数据</button>
            <button class="export">导出数据</button>
            <input type="text" class="search-input" placeholder="搜索姓名/院校/城市">
            <button class="search-btn">搜索</button>
            <select class="sort-select">
                <option value="default">默认排序</option>
                <option value="salary-asc">薪资升序</option>
                <option value="salary-desc">薪资降序</option>
                <option value="age-asc">年龄升序</option>
                <option value="age-desc">年龄降序</option>
            </select>
            <button class="logout-btn" style="margin-left: auto; background: #d9534f;">退出登录</button>
        </div>

        <!-- 新增表单 -->
        <form class="info">
            姓名: <input type="text" class="uname" required>
            性别: <select class="gender" required>
                <option value="" disabled selected>请选择</option>
                <option value="男">男</option>
                <option value="女">女</option>
            </select>
            年龄: <input type="number" class="age" min="18" required>
            电话: <input type="tel" class="phone" required>
            院校: <input type="text" class="yx" required>
            城市: <select class="city" required>
                <option value="" disabled selected>请选择</option>
                <option value="北京">北京</option>
                <option value="上海">上海</option>
                <option value="广州">广州</option>
                <option value="深圳">深圳</option>
            </select>
            薪资: <input type="number" class="salary" min="0" required>
            <button type="submit" class="submit-btn">提交</button>
        </form>

        <!-- 统计区 -->
        <div class="title"></div>

        <!-- 表格 -->
        <table>
            <thead>
                <tr>
                    <th>ID</th><th>姓名</th><th>性别</th><th>年龄</th><th>电话</th><th>院校</th><th>城市</th><th>薪资</th><th>录入时间</th><th>操作</th>
                </tr>
            </thead>
            <tbody class="table-body"></tbody>
        </table>

        <!-- 编辑弹窗 -->
        <div class="modal" id="editModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>编辑信息</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="editForm">
                    <input type="hidden" id="editId">
                    姓名: <input type="text" id="editName" required><br><br>
                    性别: <select id="editGender" required>
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select><br><br>
                    年龄: <input type="number" id="editAge" min="18" required><br><br>
                    电话: <input type="tel" id="editPhone" required><br><br>
                    院校: <input type="text" id="editYx" required><br><br>
                    城市: <select id="editCity" required>
                        <option value="北京">北京</option>
                        <option value="上海">上海</option>
                        <option value="广州">广州</option>
                        <option value="深圳">深圳</option>
                    </select><br><br>
                    薪资: <input type="number" id="editSalary" min="0" required><br><br>
                    <div class="modal-footer">
                        <button type="button" class="cancel-btn">取消</button>
                        <button type="submit" class="submit-btn">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ====================== 用户认证相关 ======================
        const authModal = document.getElementById('authModal');
        const operationArea = document.getElementById('operationArea');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginTip = document.getElementById('loginTip');
        const regTip = document.getElementById('regTip');
        const logoutBtn = document.querySelector('.logout-btn');

        // 切换登录/注册标签
        document.querySelectorAll('.auth-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabType = tab.dataset.tab;
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(`${tabType}Form`).classList.add('active');
                loginTip.textContent = '';
                regTip.textContent = '';
            });
        });

        // 获取/保存用户数据
        const getUsers = () => JSON.parse(localStorage.getItem('systemUsers')) || [];
        const saveUsers = (users) => localStorage.setItem('systemUsers', JSON.stringify(users));

        // 注册功能
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPwd = document.getElementById('regConfirmPwd').value;

            if (!username) return regTip.textContent = '用户名不能为空';
            if (password.length < 6) return regTip.textContent = '密码长度不能少于6位';
            if (password !== confirmPwd) return regTip.textContent = '两次密码输入不一致';

            const users = getUsers();
            if (users.some(u => u.username === username)) {
                return regTip.textContent = '该用户名已被注册';
            }

            users.push({ username, password });
            saveUsers(users);
            regTip.textContent = '注册成功，可登录！';
            regTip.style.color = 'green';
            document.querySelector('.auth-tab[data-tab="login"]').click();
            document.getElementById('loginUsername').value = username;
        });

        // 登录功能
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            const users = getUsers();
            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                localStorage.setItem('currentLoginUser', username);
                authModal.style.display = 'none';
                operationArea.style.display = 'block';
                initStudentData();
                render();
            } else {
                loginTip.textContent = '用户名或密码错误';
            }
        });

        // 退出登录
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('currentLoginUser');
            authModal.style.display = 'flex';
            operationArea.style.display = 'none';
            loginForm.reset();
            loginTip.textContent = '';
        });

        // ====================== 学生就业信息相关 ======================
        // 本地存储操作（确保ID正确）
        const getStudentData = () => {
            let data = JSON.parse(localStorage.getItem('studentData')) || [];
            // 修复已有数据中ID为undefined的问题
            if (data.length) {
                data = data.map((item, index) => {
                    if (item.stuid === undefined) {
                        item.stuid = index + 1;
                    }
                    return item;
                });
                saveStudentData(data);
            }
            return data;
        };
        const saveStudentData = (data) => localStorage.setItem('studentData', JSON.stringify(data));

        // 强制初始化默认数据（覆盖旧数据，确保页面加载就有数据）
        const defaultData = [
            { stuid: 1, name: "张三", gender: "男", age: 30, phone: "13245636217", yx: "北京大学", city: "深圳", salary: 12000, time: "2025/10/23" },
            { stuid: 2, name: "林好", gender: "女", age: 32, phone: "13245636218", yx: "中山大学", city: "广州", salary: 8000, time: "2025/10/25" }
        ];
        
        // 页面元素
        const [tbody, titleEl, form, editModal, editForm] = [
            document.querySelector('.table-body'),
            document.querySelector('.title'),
            document.querySelector('.info'),
            document.getElementById('editModal'),
            document.getElementById('editForm')
        ];
        const [searchInput, searchBtn, sortSelect, exportBtn, closeBtn, cancelBtn] = [
            document.querySelector('.search-input'),
            document.querySelector('.search-btn'),
            document.querySelector('.sort-select'),
            document.querySelector('.export'),
            document.querySelector('.close-btn'),
            document.querySelector('.cancel-btn')
        ];

        // 修复后的render函数（排序逻辑提前，确保加载时显示数据）
        function render(filteredData = null) {
            // 1. 优先读取传入的过滤数据，否则读本地存储
            let data = filteredData || getStudentData();
            
            // 2. 排序逻辑（提前执行，不影响默认数据显示）
            const sortType = sortSelect.value;
            if (sortType !== 'default') {
                const [key, order] = sortType.split('-');
                data = [...data].sort((a, b) => {
                    return order === 'asc' ? a[key] - b[key] : b[key] - a[key];
                });
            }

            // 3. 显示统计数据
            const totalCount = data.length;
            titleEl.textContent = `共 ${totalCount} 条学生就业信息`;

            // 4. 渲染表格
            tbody.innerHTML = data.length 
                ? data.map(item => `
                    <tr>
                        <td>${item.stuid}</td>
                        <td>${item.name}</td>
                        <td>${item.gender}</td>
                        <td>${item.age}</td>
                        <td>${item.phone}</td>
                        <td>${item.yx}</td>
                        <td>${item.city}</td>
                        <td>${item.salary}</td>
                        <td>${item.time}</td>
                        <td class="operation">
                            <a href="javascript:;" class="edit" data-id="${item.stuid}">编辑</a>
                            <a href="javascript:;" class="delete" data-id="${item.stuid}">删除</a>
                        </td>
                    </tr>
                `).join('')
                : '<tr><td colspan="10" style="text-align:center">暂无匹配数据</td></tr>';
        }

        // 新增数据
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const [uname, gender, age, phone, yx, city, salary] = [
                document.querySelector('.uname').value.trim(),
                document.querySelector('.gender').value,
                document.querySelector('.age').value,
                document.querySelector('.phone').value.trim(),
                document.querySelector('.yx').value.trim(),
                document.querySelector('.city').value,
                document.querySelector('.salary').value
            ];
            if (!uname || !gender || !age || !phone || !yx || !city || !salary) return alert('所有字段不能为空！');
            if (!/^1[3-9]\d{9}$/.test(phone)) return alert('手机号格式错误！');

            const data = getStudentData();
            const maxId = data.length > 0 ? Math.max(...data.map(item => item.stuid)) : 0;
            const newId = maxId + 1;

            data.push({
                stuid: newId,
                name: uname,
                gender,
                age: +age,
                phone,
                yx,
                city,
                salary: +salary,
                time: new Date().toLocaleDateString()
            });
            saveStudentData(data);
            render();
            form.reset();
        });

        // 编辑功能
        tbody.addEventListener('click', (e) => {
            if (e.target.classList.contains('edit')) {
                const id = +e.target.dataset.id;
                const item = getStudentData().find(i => i.stuid === id);
                if (item) {
                    document.getElementById('editId').value = item.stuid;
                    document.getElementById('editName').value = item.name;
                    document.getElementById('editGender').value = item.gender;
                    document.getElementById('editAge').value = item.age;
                    document.getElementById('editPhone').value = item.phone;
                    document.getElementById('editYx').value = item.yx;
                    document.getElementById('editCity').value = item.city;
                    document.getElementById('editSalary').value = item.salary;
                    editModal.style.display = 'flex';
                }
            }
        });

        // 保存编辑
        editForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = +document.getElementById('editId').value;
            const data = getStudentData();
            const index = data.findIndex(item => item.stuid === id);
            if (index !== -1) {
                data[index] = {
                    ...data[index],
                    name: document.getElementById('editName').value.trim(),
                    gender: document.getElementById('editGender').value,
                    age: +document.getElementById('editAge').value,
                    phone: document.getElementById('editPhone').value.trim(),
                    yx: document.getElementById('editYx').value.trim(),
                    city: document.getElementById('editCity').value,
                    salary: +document.getElementById('editSalary').value
                };
                saveStudentData(data);
                render();
                editModal.style.display = 'none';
            }
        });

        // 删除功能
        tbody.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete') && confirm('确定删除？')) {
                const id = +e.target.dataset.id;
                saveStudentData(getStudentData().filter(item => item.stuid !== id));
                render();
            }
        });

        // 搜索功能
        function handleSearch() {
            const keyword = searchInput.value.trim().toLowerCase();
            render(keyword ? getStudentData().filter(item => 
                item.name.toLowerCase().includes(keyword) ||
                item.yx.toLowerCase().includes(keyword) ||
                item.city.toLowerCase().includes(keyword)
            ) : null);
        }
        searchBtn.addEventListener('click', handleSearch);
        searchInput.addEventListener('keyup', (e) => e.key === 'Enter' && handleSearch());

        // 排序功能
        sortSelect.addEventListener('change', render);

        // 导出功能
        function exportToExcel() {
            const data = getStudentData();
            if (!data.length) return alert('暂无数据可导出！');
            const csv = 'ID,姓名,性别,年龄,电话号码,毕业院校,就业城市,薪资,录入时间\n' +
            data.map(item => `${item.stuid},${item.name},${item.gender},${item.age},${item.phone},${item.yx},${item.city},${item.salary},${item.time}`).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `学生就业信息_${new Date().toLocaleDateString()}.csv`;
            a.click();
        }
        exportBtn.addEventListener('click', exportToExcel);

        // 关闭编辑弹窗
        closeBtn.addEventListener('click', () => editModal.style.display = 'none');
        cancelBtn.addEventListener('click', () => editModal.style.display = 'none');

        // 页面加载时强制渲染本地存储数据
        window.onload = () => {
            render(getStudentData());
        };
    </script>
</body>
</html>

		
